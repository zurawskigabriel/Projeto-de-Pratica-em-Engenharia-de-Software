CREATE TABLE IF NOT EXISTS Usuario (
    User_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nome VARCHAR(100) NOT NULL,
    Telefone VARCHAR(20),
    Email VARCHAR(100) NOT NULL UNIQUE,
    Senha_hash VARCHAR(255) NOT NULL,
    Data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    Tipo VARCHAR(20) NOT NULL,
    CHECK (Tipo IN ('Adotante', 'Protetor', 'ONG'))
);

CREATE TABLE IF NOT EXISTS UserHistory (
    History_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    User_id INT NOT NULL,
    Mensagem CLOB,
    Data TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (User_id) REFERENCES Usuario(User_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Pet (
    Pet_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    User_id INT NOT NULL,
    Nome VARCHAR(100) NOT NULL,
    Especie VARCHAR(50) NOT NULL,
    Idade INT,
    Porte VARCHAR(20),
    Peso DOUBLE,
    Sexo CHAR(1) CHECK (Sexo IN ('M', 'F', 'O')),
    Bio CLOB,
    Fotos BLOB,
    FOREIGN KEY (User_id) REFERENCES Usuario(User_id)
);

CREATE TABLE IF NOT EXISTS MedicalPetHistory (
    Hist_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Pet_id INT NOT NULL,
    Hospital VARCHAR(100),
    Resultado CLOB,
    Tratamento CLOB,
    Documento VARCHAR(255),
    Data DATE,
    FOREIGN KEY (Pet_id) REFERENCES Pet(Pet_id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Adoption (
    Adoption_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Pet_id INT NOT NULL,
    Adopter_id INT NOT NULL,
    Status VARCHAR(20) NOT NULL,
    CHECK (Status IN ('Pendente', 'Aceita', 'Rejeitada', 'Finalizada')),
    FOREIGN KEY (Pet_id) REFERENCES Pet(Pet_id),
    FOREIGN KEY (Adopter_id) REFERENCES Usuario(User_id)
);

CREATE TABLE IF NOT EXISTS AdoptionHistory (
    AdoptionHist_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Adoption_id INT NOT NULL,
    Trainer_id INT NOT NULL,
    Data TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (Adoption_id) REFERENCES Adoption(Adoption_id) ON DELETE CASCADE,
    FOREIGN KEY (Trainer_id) REFERENCES Usuario(User_id)
);

CREATE TABLE IF NOT EXISTS Categorias (
    Categoria_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nome VARCHAR(50) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS Tags (
    Tag_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Nome VARCHAR(50) NOT NULL,
    Categoria_id INT,
    FOREIGN KEY (Categoria_id) REFERENCES Categorias(Categoria_id) ON DELETE SET NULL
);

CREATE TABLE IF NOT EXISTS PetTags (
    Pet_id INT NOT NULL,
    Tag_id INT NOT NULL,
    PRIMARY KEY (Pet_id, Tag_id),
    FOREIGN KEY (Pet_id) REFERENCES Pet(Pet_id) ON DELETE CASCADE,
    FOREIGN KEY (Tag_id) REFERENCES Tags(Tag_id) ON DELETE CASCADE
);